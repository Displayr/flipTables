context("TidyTools")

dat <- structure(c(1.13154172560113, 0.99009900990099, 0.282885431400283, 
    0.565770862800566, 1.6973125884017, 2.12164073550212, 1.13154172560113, 
    2.54596888260255, 1.83875530410184, 12.3055162659123, 0, 0.99009900990099, 
    0.707213578500707, 0.848656294200849, 0.565770862800566, 0.707213578500707, 
    3.96039603960396, 1.27298444130127, 2.54596888260255, 11.5983026874116, 
    0, 0.848656294200849, 0.707213578500707, 1.41442715700141, 0.848656294200849, 
    0, 1.6973125884017, 2.97029702970297, 1.98019801980198, 10.4667609618105, 
    0.282885431400283, 0.424328147100424, 1.83875530410184, 0.565770862800566, 
    0.99009900990099, 0.848656294200849, 2.68741159830269, 1.83875530410184, 
    1.83875530410184, 11.3154172560113, 0, 0.848656294200849, 0.424328147100424, 
    0.848656294200849, 0.424328147100424, 1.83875530410184, 0.99009900990099, 
    1.41442715700141, 4.52616690240453, 11.3154172560113, 0, 0, 0.565770862800566, 
    1.13154172560113, 0.848656294200849, 0.424328147100424, 0.424328147100424, 
    2.26308345120226, 1.98019801980198, 7.63790664780764, 0, 0.848656294200849, 
    0.282885431400283, 0.848656294200849, 1.27298444130127, 0.99009900990099, 
    2.26308345120226, 1.98019801980198, 3.67751060820368, 12.1640735502122, 
    1.55586987270156, 0.848656294200849, 1.41442715700141, 2.12164073550212, 
    2.68741159830269, 2.26308345120226, 1.41442715700141, 0.848656294200849, 
    3.67751060820368, 16.8316831683168, 0.282885431400283, 0, 0, 
    0, 0.99009900990099, 1.6973125884017, 0, 3.11173974540311, 0.282885431400283, 
    6.36492220650637, 3.25318246110325, 5.7991513437058, 6.22347949080622, 
    8.34512022630834, 10.3253182461103, 10.8910891089109, 14.5685997171146, 
    18.2461103253182, 22.3479490806223, 100), 
.Dim = c(10L, 10L), statistic = "Total %", .Dimnames = list(
c("Less than $15,000", "$200,001 or more", "$150,001 to $200,000", 
"$120,001 to $150,000", "$30,001 to $45,000", "$15,001 to $30,000", 
"$90,001 to $120,000", "$45,001 to $60,000", "$60,001 to $90,000", 
"NET"), c("18 to 24", "25 to 29", "30 to 34", "35 to 39", 
"40 to 44", "45 to 49", "50 to 54", "55 to 64", "65 or more", 
"NET")), name = "Income by Age", questions = c("Income", "Age"))

test_that("SelectRows",
{
    xx <- matrix(1:12, 3, 4, dimnames=list(LETTERS[1:3], letters[1:4]))
    x2 <- SelectRows(xx, "A,A,C")
    expect_equal(x2[1,], x2[2,])
    expect_warning(SelectRows(xx, "A,B,D,E,F"), "Table does not contain rows 'D','E','F'.")
    expect_warning(x3 <- SelectRows(xx, "D,E,F"), "Table does not contain rows 'D','E','F'.")
    expect_equal(nrow(x3), 0)
    x4 <- SelectRows(xx, "A,B,C,3,2,1")
    expect_warning(x5 <- SelectRows(xx, "A,B,C,3,2,1,0,7"), "Table does not contain rows '0','7'.")
    expect_equal(x5[,1], c(A=1,B=2,C=3,C=3,B=2,A=1))
})

test_that("SortRows",
{
    res <- SortRows(dat, decreasing = TRUE)
    expect_equal(dim(res), c(10, 10))
    expect_equal(rownames(res), rownames(dat)[c(9:1,10)])
})

test_that("LastKColumns",
{
    res <- LastKColumns(dat, 4)
    expect_equal(colnames(res), c("50 to 54", "55 to 64", "65 or more", "NET"))
    expect_equal(attr(res, "statistic"), "Total %")
})
